<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Utility Tools - QR Code Generator & URL Shortener</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Utility Tools</h1>
            <nav>
                <button id="qr-tab" class="tab-button active" onclick="showTab('qr')">QR Code Generator</button>
                <button id="url-tab" class="tab-button" onclick="showTab('url')">URL Shortener</button>
                <button id="svg-tab" class="tab-button" onclick="showTab('svg')">SVG Color Checker</button>
            </nav>
        </header>

        <main>
            <!-- QR Code Generator Section -->
            <section id="qr-section" class="tool-section active">
                <h2>QR Code Generator</h2>
                
                {% if qr_preview %}
                <div class="qr-preview">
                    <h3>Generated QR Code</h3>
                    <div class="qr-preview-container">
                        {% if qr_preview.format == 'svg' %}
                        <div class="qr-image-wrapper">
                            <iframe src="{{ url_for('serve_preview', preview_id=qr_preview.preview_id) }}" 
                                    class="svg-frame" 
                                    frameborder="0">
                            </iframe>
                        </div>
                        {% else %}
                        <img src="{{ url_for('serve_preview', preview_id=qr_preview.preview_id) }}" 
                             alt="Generated QR Code" 
                             class="qr-preview-image">
                        {% endif %}
                    </div>
                    <div class="qr-actions">
                        <a href="{{ url_for('download_qr') }}" class="download-btn">
                            <span class="icon">⬇</span> Download {{ qr_preview.filename }}
                        </a>
                        <button onclick="generateNew()" class="new-btn">Generate New QR Code</button>
                    </div>
                </div>
                {% endif %}
                
                <form method="post" action="/generate-qr" enctype="multipart/form-data" class="form-container {% if qr_preview %}collapsed{% endif %}" id="qr-form">
                    <div class="form-group">
                        <label for="data">Text or URL:</label>
                        <input type="text" id="data" name="data" required placeholder="Enter text or URL to encode">
                    </div>
                    
                    <div class="form-group">
                        <label for="image">Logo (optional):</label>
                        <input type="file" id="image" name="image" accept="image/*">
                    </div>
                    
                    <div class="form-group">
                        <h3>Export Format</h3>
                        <div class="radio-group">
                            <label><input type="radio" name="export_format" value="png" checked> PNG</label>
                            <label><input type="radio" name="export_format" value="svg"> SVG</label>
                        </div>
                        <div class="format-info" id="svg-info" style="display: none;">
                            <small><strong>Note:</strong> SVG format has limited styling support. Module shapes and gradient colors are only available for PNG format.</small>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <h3>Module Style</h3>
                        <div class="radio-group">
                            <label><input type="radio" name="module_drawer" value="square" checked> Square</label>
                            <label><input type="radio" name="module_drawer" value="rounded"> Rounded</label>
                            <label><input type="radio" name="module_drawer" value="circle"> Circle</label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <h3>Color Style</h3>
                        <div class="radio-group">
                            <label><input type="radio" name="color_mask" value="solid" checked> Solid</label>
                            <label><input type="radio" name="color_mask" value="radial"> Radial Gradient</label>
                            <label><input type="radio" name="color_mask" value="square"> Square Gradient</label>
                            <label><input type="radio" name="color_mask" value="custom"> Custom Colors</label>
                        </div>
                    </div>
                    
                    <div class="form-group" id="custom-colors" style="display: none;">
                        <h3>Custom Colors</h3>
                        <div class="color-picker-group">
                            <div class="color-input">
                                <label for="foreground_color">Foreground Color:</label>
                                <input type="color" id="foreground_color" name="foreground_color" value="#000000">
                            </div>
                            <div class="color-input">
                                <label for="background_color">Background Color:</label>
                                <input type="color" id="background_color" name="background_color" value="#ffffff">
                            </div>
                        </div>
                        <div class="color-picker-group" id="gradient-colors" style="display: none;">
                            <div class="color-input">
                                <label for="gradient_start">Gradient Start:</label>
                                <input type="color" id="gradient_start" name="gradient_start" value="#000000">
                            </div>
                            <div class="color-input">
                                <label for="gradient_end">Gradient End:</label>
                                <input type="color" id="gradient_end" name="gradient_end" value="#0066ff">
                            </div>
                        </div>
                        <div class="form-group">
                            <label><input type="checkbox" id="use_gradient" name="use_gradient"> Use Gradient</label>
                        </div>
                    </div>
                    
                    <button type="submit" class="submit-btn">Generate QR Code</button>
                </form>
                
                <div class="examples">
                    <h3>Style Examples</h3>
                    <div class="example-grid">
                        <div class="example-item">
                            <img src="{{ url_for('static', filename='images/rounded.png') }}" alt="Rounded modules">
                            <p>Rounded Modules</p>
                        </div>
                        <div class="example-item">
                            <img src="{{ url_for('static', filename='images/circle.png') }}" alt="Circle modules">
                            <p>Circle Modules</p>
                        </div>
                        <div class="example-item">
                            <img src="{{ url_for('static', filename='images/radial.png') }}" alt="Radial gradient">
                            <p>Radial Gradient</p>
                        </div>
                        <div class="example-item">
                            <img src="{{ url_for('static', filename='images/square_gradient.png') }}" alt="Square gradient">
                            <p>Square Gradient</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- URL Shortener Section -->
            <section id="url-section" class="tool-section">
                <h2>Confluence URL Shortener</h2>
                <div class="info-box">
                    <h3>📚 About Confluence URL Shortener</h3>
                    <p>This tool is specifically designed for <strong>Atlassian Confluence</strong> URLs. It converts long Confluence page URLs into compact, shareable links using Confluence's built-in tiny link format.</p>
                    <p><strong>How it works:</strong> The tool extracts the page ID from your Confluence URL and generates a short link in the format: <code>https://your-confluence.com/x/[token]</code></p>
                    <p><strong>Compatible URL formats:</strong></p>
                    <ul>
                        <li><code>https://confluence.com/display/SPACE/Page+Title</code></li>
                        <li><code>https://confluence.com/pages/viewpage.action?pageId=123456</code></li>
                        <li><code>https://confluence.com/pages/123456/page-title</code></li>
                    </ul>
                </div>
                
                <form method="post" action="/shorten-url" class="form-container">
                    <div class="form-group">
                        <label for="full_url">Confluence Page URL:</label>
                        <input type="url" id="full_url" name="full_url" required 
                               placeholder="https://confluence.example.com/pages/123456789/page-title">
                        <small>Paste your full Confluence page URL here</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="base_url">Custom Base URL (optional):</label>
                        <input type="url" id="base_url" name="base_url" 
                               placeholder="https://myconfluence.com">
                        <small>Leave empty to auto-detect from the full URL. Use this if you want to generate a short link for a different Confluence instance.</small>
                    </div>
                    
                    <button type="submit" class="submit-btn">Generate Short Link</button>
                </form>
                
                {% if short_url %}
                <div class="result">
                    <h3>Shortened URL:</h3>
                    <div class="url-result">
                        <input type="text" value="{{ short_url }}" readonly id="short-url-input">
                        <button onclick="copyToClipboard('short-url-input')" class="copy-btn">Copy</button>
                    </div>
                </div>
                {% endif %}
            </section>

            <!-- SVG Color Checker Section -->
            <section id="svg-section" class="tool-section">
                <h2>SVG Color Checker</h2>
                <div class="info-box">
                    <h3>🎨 About SVG Color Checker</h3>
                    <p>This tool analyzes SVG files to check their colors, stroke widths, and other properties. It's based on the svg_checker.py functionality.</p>
                    <p><strong>Features:</strong></p>
                    <ul>
                        <li>Extract all colors used in SVG shapes</li>
                        <li>Check stroke widths and opacity values</li>
                        <li>Identify shape types and their properties</li>
                        <li>Get color suggestions for QR code generation</li>
                        <li>Validate SVG compliance with specific color requirements</li>
                    </ul>
                </div>
                
                <form method="post" action="/check-svg" enctype="multipart/form-data" class="form-container" id="svg-form">
                    <div class="form-group">
                        <label for="svg_file">Upload SVG File:</label>
                        <input type="file" id="svg_file" name="svg_file" accept=".svg,image/svg+xml" required>
                        <small>Select an SVG file to analyze its colors and properties</small>
                    </div>
                    
                    <div class="form-group">
                        <label for="svg_text">Or Paste SVG Content:</label>
                        <textarea id="svg_text" name="svg_text" rows="10" placeholder="<svg>...</svg>" style="width: 100%; font-family: monospace; font-size: 12px;"></textarea>
                        <small>Alternatively, paste SVG XML content directly</small>
                    </div>
                    
                    <div class="form-group">
                        <h3>Check Options</h3>
                        <label><input type="checkbox" name="check_red" checked> Check for 100% red strokes</label>
                        <label><input type="checkbox" name="check_width" checked> Check for 1mm stroke width</label>
                        <label><input type="checkbox" name="check_opacity" checked> Check for full opacity</label>
                    </div>
                    
                    <button type="submit" class="submit-btn">Analyze SVG</button>
                </form>
                
                {% if svg_analysis %}
                <div class="svg-analysis-results">
                    <h3>Analysis Results</h3>
                    
                    <div class="result-summary">
                        <p><strong>Total shapes found:</strong> {{ svg_analysis.total_shapes }}</p>
                        <p><strong>Unique colors:</strong> {{ svg_analysis.color_summary.unique_colors|length }}</p>
                        
                        {% if svg_analysis.color_summary.has_gradients %}
                        <p class="warning">⚠️ Gradients detected in SVG</p>
                        {% endif %}
                        
                        {% if svg_analysis.compliance.total_with_stroke > 0 %}
                        <div class="compliance-summary">
                            <h4>SVG Compliance Check</h4>
                            <p><strong>Shapes with red strokes:</strong> {{ svg_analysis.compliance.red_strokes }} / {{ svg_analysis.compliance.total_with_stroke }}</p>
                            <p><strong>Shapes with 1mm stroke width:</strong> {{ svg_analysis.compliance.correct_width }} / {{ svg_analysis.total_shapes }}</p>
                            <p><strong>Shapes with full opacity:</strong> {{ svg_analysis.compliance.correct_opacity }} / {{ svg_analysis.total_shapes }}</p>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="color-display">
                        <h4>Colors Found</h4>
                        <div class="color-grid">
                            {% for color in svg_analysis.color_summary.unique_colors %}
                            <div class="color-item">
                                <div class="color-swatch" style="background-color: {{ color }}"></div>
                                <span>{{ color }}</span>
                                <button onclick="copyColor('{{ color }}')" class="small-btn">Copy</button>
                                <button onclick="useColorInPicker('{{ color }}')" class="small-btn">Use in QR</button>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    <div class="shape-details">
                        <h4>Shape Details</h4>
                        <div class="shape-list">
                            {% for shape in svg_analysis.shapes %}
                            <div class="shape-item">
                                <h5>{{ shape.tag }} ({{ shape.id }})</h5>
                                <table class="shape-properties">
                                    <tr>
                                        <td>Stroke:</td>
                                        <td>
                                            {% if shape.stroke.color %}
                                            <span class="color-display-inline" style="background-color: {{ shape.stroke.color }}"></span>
                                            {{ shape.stroke.color }}
                                            {% if shape.stroke.color == 'red' or shape.stroke.color == '#ff0000' %}
                                            <span class="status-ok">✓</span>
                                            {% elif check_red %}
                                            <span class="status-warning">⚠️ Should be red</span>
                                            {% endif %}
                                            {% else %}
                                            None
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Fill:</td>
                                        <td>
                                            {% if shape.fill.color %}
                                            <span class="color-display-inline" style="background-color: {{ shape.fill.color }}"></span>
                                            {{ shape.fill.color }}
                                            {% else %}
                                            None
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Stroke Width:</td>
                                        <td>
                                            {{ shape.stroke_width or 'Not set' }}
                                            {% if shape.stroke_width == '1mm' %}
                                            <span class="status-ok">✓</span>
                                            {% elif check_width and shape.stroke_width %}
                                            <span class="status-warning">⚠️ Should be 1mm</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Stroke Opacity:</td>
                                        <td>
                                            {{ shape.stroke_opacity }}
                                            {% if shape.stroke_opacity == '1' %}
                                            <span class="status-ok">✓</span>
                                            {% elif check_opacity %}
                                            <span class="status-warning">⚠️ Should be 1</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </table>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                    {% if color_suggestions %}
                    <div class="color-suggestions">
                        <h4>Suggested Colors for QR Generator</h4>
                        <div class="suggestion-grid">
                            <div class="suggestion-item">
                                <label>Foreground:</label>
                                <span class="color-display-inline" style="background-color: {{ color_suggestions.foreground }}"></span>
                                {{ color_suggestions.foreground }}
                                <button onclick="useColorInPicker('{{ color_suggestions.foreground }}')" class="small-btn">Use</button>
                            </div>
                            <div class="suggestion-item">
                                <label>Background:</label>
                                <span class="color-display-inline" style="background-color: {{ color_suggestions.background }}"></span>
                                {{ color_suggestions.background }}
                                <button onclick="useColorInPicker('{{ color_suggestions.background }}')" class="small-btn">Use</button>
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
                {% endif %}
            </section>
        </main>
    </div>

    <script src="{{ url_for('static', filename='js/script.js') }}"></script>
</body>
</html>